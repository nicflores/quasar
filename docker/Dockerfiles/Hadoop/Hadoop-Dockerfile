FROM java:8u111-jre

COPY wrapper_script.sh wrapper_script.sh
ARG HADOOP_VERSION

RUN apt-get update
RUN apt-get -y install ssh

COPY hadoop-${HADOOP_VERSION}.tar.gz /tmp/hadoop-${HADOOP_VERSION}.tar.gz

# hadoop setup
RUN tar -xf /tmp/hadoop-${HADOOP_VERSION}.tar.gz -C /opt/
RUN mv /opt/hadoop-${HADOOP_VERSION} /opt/hadoop
RUN rm -rf /tmp/hadoop-${HADOOP_VERSION}.tar.gz
COPY core-site.xml /opt/hadoop/etc/hadoop/
COPY hdfs-site.xml /opt/hadoop/etc/hadoop/
COPY slaves /opt/hadoop/etc/hadoop/
COPY hadoop.sh /etc/profile.d/
RUN mkdir /opt/hadoop/logs

RUN ssh-keygen -t rsa -P '' -f /root/.ssh/id_rsa
RUN cat /root/.ssh/id_rsa.pub >> /root/.ssh/authorized_keys
RUN chmod 0600 /root/.ssh/authorized_keys

RUN /opt/hadoop/bin/hdfs namenode -format
RUN apt-get clean all

EXPOSE 8030-8033 8088 9000 10020 19888 50010 50020 50070 50075 50090

CMD ./wrapper_script.sh
